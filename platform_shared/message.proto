syntax = "proto3";

package socket_message;

message Vector { float x = 1; float y = 2; }
message I2CDevice { int32 address = 1; string part_number = 2; string name = 3; }
message PinConfig { int32 pin = 1; string mode = 2; string type = 3; string role = 4; }
message KnownNetworkItem { string ssid = 1; string password = 2; bool static_ip = 3; uint32 local_ip = 4; uint32 subnet_mask = 5; uint32 gateway_ip = 6; uint32 dns_ip_1 = 7; uint32 dns_ip_2 = 8; }

message ServoConfig {
    float center_pwm = 1;
    float direction = 2;
    float center_angle = 3;
    float conversion = 4;
}

message ServoSettingsData { repeated ServoConfig servos = 1; }

message CameraSettingsData {
    int32 pixformat = 1;
    int32 framesize = 2;
    int32 quality = 3;
    int32 brightness = 4;
    int32 contrast = 5;
    int32 saturation = 6;
    int32 sharpness = 7;
    int32 denoise = 8;
    int32 special_effect = 9;
    int32 wb_mode = 10;
    int32 exposure_ctrl = 11;
    int32 gain_ctrl = 12;
    int32 awb = 13;
    int32 awb_gain = 14;
    int32 aec = 15;
    int32 aec2 = 16;
    int32 ae_level = 17;
    int32 aec_value = 18;
    int32 agc = 19;
    int32 agc_gain = 20;
    int32 gainceiling = 21;
    int32 bpc = 22;
    int32 wpc = 23;
    int32 raw_gma = 24;
    int32 lenc = 25;
    int32 hmirror = 26;
    int32 vflip = 27;
    int32 dcw = 28;
    int32 colorbar = 29;
}

message APSettingsData {
    int32 provision_mode = 1;
    string ssid = 2;
    string password = 3;
    int32 channel = 4;
    bool ssid_hidden = 5;
    int32 max_clients = 6;
    uint32 local_ip = 7;
    uint32 gateway_ip = 8;
    uint32 subnet_mask = 9;
}

message APStatusData {
    int32 status = 1;
    uint32 ip_address = 2;
    string mac_address = 3;
    int32 station_num = 4;
}

message NetworkInfo {
    int32 rssi = 1;
    string ssid = 2;
    string bssid = 3;
    int32 channel = 4;
    int32 encryption_type = 5;
}

message NetworkListData { repeated NetworkInfo networks = 1; }

message NetworkStatusData {
    int32 status = 1;
    uint32 local_ip = 2;
    string mac_address = 3;
    int32 rssi = 4;
    string ssid = 5;
    string bssid = 6;
    int32 channel = 7;
    uint32 subnet_mask = 8;
    uint32 gateway_ip = 9;
    uint32 dns_ip_1 = 10;
    uint32 dns_ip_2 = 11;
}

message MDNSTxtRecord { string key = 1; string value = 2; }

message MDNSServiceConfig {
    string service = 1;
    string protocol = 2;
    int32 port = 3;
    repeated MDNSTxtRecord txt_records = 4;
}

message MDNSSettingsData {
    string hostname = 1;
    string instance = 2;
    repeated MDNSServiceConfig services = 3;
    repeated MDNSTxtRecord global_txt_records = 4;
}

message MDNSStatusData {
    string hostname = 1;
    string instance = 2;
    repeated MDNSServiceConfig services = 3;
}

message MDNSQueryRequest { string service = 1; string protocol = 2; }

message MDNSQueryResult {
    string hostname = 1;
    string address = 2;
    int32 port = 3;
    repeated MDNSTxtRecord txt_records = 4;
}

message MDNSQueryResponse { repeated MDNSQueryResult services = 1; }

message FileEntry { string name = 1; int64 size = 2; bool is_directory = 3; }
message FileListData { repeated FileEntry files = 1; string path = 2; }
message FileDeleteRequest { string file = 1; }
message FileEditRequest { string file = 1; string content = 2; }
message FileMkdirRequest { string path = 1; }
message FileContentData { string content = 1; }

message SystemStatusData {
    string esp_platform = 1;
    string firmware_version = 2;
    int32 max_alloc_heap = 3;
    int32 psram_size = 4;
    int32 free_psram = 5;
    int32 cpu_freq_mhz = 6;
    string cpu_type = 7;
    int32 cpu_rev = 8;
    int32 cpu_cores = 9;
    int32 free_heap = 10;
    int32 min_free_heap = 11;
    int32 sketch_size = 12;
    int32 free_sketch_space = 13;
    string sdk_version = 14;
    string arduino_version = 15;
    int32 flash_chip_size = 16;
    int32 flash_chip_speed = 17;
    int32 fs_total = 18;
    int32 fs_used = 19;
    float core_temp = 20;
    string cpu_reset_reason = 21;
    int64 uptime = 22;
}

message NTPSettingsData {
    bool enabled = 1;
    string server = 2;
    string tz_label = 3;
    string tz_format = 4;
}

message EmptyRequest {}
message EmptyResponse {}

// Individual message data types
message IMUData {
    float x = 1;
    float y = 2;
    float z = 3;
    float heading = 4;
    float altitude = 5;
    float bmp_temp = 6;
    float pressure = 7;
}

// FEATURE DATA
message FeaturesDataResponse {
    string variant = 10;
    string firmware_built_target = 20;
    string firmware_name = 30;
    string firmware_version = 40;
    
    bool camera = 50;
    bool imu = 60;
    bool mag = 70;
    bool bmp = 80;
    bool sonar = 90;
    bool servo = 100;
    bool ws2812 = 110;
    bool mdns = 120;
    bool embed_www = 130;
}

message FeaturesDataRequest { }

// SYSTEM INFORMATION

message SystemInformationRequest { }
message SystemInformationResponse {
    AnalyticsData analytics_data = 1;
    StaticSystemInformation static_system_information = 2;
}

message CorrelationRequest {
    uint32 correlation_id = 1;
    oneof request {
        FeaturesDataRequest features_data_request = 10;
        I2CScanDataRequest i2c_scan_data_request = 20;
        IMUCalibrateExecute imu_calibrate_execute = 30;
        SystemInformationRequest system_information_request = 40;
    }
}

message CorrelationResponse {
    uint32 correlation_id = 1;
    uint32 status_code = 2;
    oneof response {
        FeaturesDataResponse features_data_response = 10;
        I2CScanData i2c_scan_data = 20;
        IMUCalibrateData imu_calibrate_data = 30;
        SystemInformationResponse system_information_response = 40;
    }
}

enum ModesEnum {
    DEACTIVATED = 0;
    IDLE = 1;
    CALIBRATION = 2;
    REST = 3;
    STAND = 4;
    WALK = 5;
}

message StaticSystemInformation {
    string esp_platform = 1; 
    string firmware_version = 2; 
    uint32 cpu_freq_mhz = 3; 
    string cpu_type = 4; 
    int32 cpu_rev = 5; 
    uint32 cpu_cores = 6; 
    uint32 sketch_size = 7; 
    uint32 free_sketch_space = 8; 
    string sdk_version = 9; 
    string arduino_version = 10; 
    uint32 flash_chip_size = 11; 
    uint32 flash_chip_speed = 12; 
    string cpu_reset_reason = 13; 
}

message IMUCalibrateData { bool success = 1; }

message IMUCalibrateExecute {}

message ModeData { ModesEnum mode = 1; }

message ControllerInputData {
    Vector left = 1;
    Vector right = 2;
    float height = 3;
    float speed = 4;
    float s1 = 5;
}

message AnalyticsData {
    int32 max_alloc_heap = 1;
    int32 psram_size = 2;
    int32 free_psram = 3;
    int32 free_heap = 4;
    int32 total_heap = 5;
    int32 min_free_heap = 6;
    float core_temp = 7;
    int32 fs_total = 8;
    int32 fs_used = 9;
    int64 uptime = 10;
    int32 cpu0_usage = 11;
    int32 cpu1_usage = 12;
    int32 cpu_usage = 13;
}

message ServoPWMData {
    int32 servo_id = 1;
    uint32 servo_pwm = 2;
}

message ServoStateData {
    bool active = 1;
}

message AnglesData { repeated int32 angles = 1; }

message I2CScanData { repeated I2CDevice devices = 1; }

message I2CScanDataRequest {}

message PeripheralSettingsData { int32 sda = 1; int32 scl = 2; int32 frequency = 3; }

message PeripheralSettingsDataRequest {}

message WifiSettingsData { string hostname = 1; bool priority_rssi = 2; repeated KnownNetworkItem wifi_networks = 3; }

message RSSIData { int32 rssi = 1; }

message DownloadOTAData { string status = 1; int32 progress = 2; string error = 3; }

message SonarData { string dummy_field = 1; }

message ControllerData {
    Vector left = 10; Vector right = 11; float height = 20; float speed = 21; float s1 = 22;
}

message SystemInformation {
    AnalyticsData analytics_data = 1; StaticSystemInformation static_system_information = 2;
}

enum WalkGaits {
    TROT = 0;
    CRAWL = 1;
}

message WalkGaitData {
    WalkGaits gait = 1;
}

message KinematicData {
    float omega = 1;
    float phi = 2;
    float psi = 3;
    float xm = 4;
    float ym = 5;
    float zm = 6;
}

message SubscribeNotification { int32 tag = 1; }

message UnsubscribeNotification {int32 tag = 1; }

message PingMsg {}

message PongMsg {}

// WebSocket message wrapper
message Message {
    oneof message {
        CorrelationRequest correlation_request = 10;
        CorrelationResponse correlation_response = 11;
        SubscribeNotification sub_notif = 20;
        UnsubscribeNotification unsub_notif = 21;
        PingMsg pingmsg = 30;
        PongMsg pongmsg = 31;
        IMUData imu = 110;
        IMUCalibrateData imu_calibrate = 120;
        IMUCalibrateExecute imu_calibrate_execute = 121;
        ModeData mode = 130;
        ControllerInputData input = 140;
        AnalyticsData analytics = 150;
        WalkGaitData walk_gait = 160;
        AnglesData angles = 170;
        I2CScanData i2c_scan = 180;
        I2CScanDataRequest i2c_scan_data_request = 181;
        PeripheralSettingsData peripheral_settings = 190;
        PeripheralSettingsDataRequest peripheral_settings_data_request = 191;
        KinematicData kinematic_data = 200;
        ServoPWMData servo_pwm = 210;
        ServoStateData servo_state = 211;
        WifiSettingsData wifi_settings = 240;
        ControllerData controller_data = 250;
        RSSIData rssi = 260;
    }
}
